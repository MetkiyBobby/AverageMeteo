#! python3
# Программа для подсчета среднесуточных и среднемесячных значений и не только
# метеовеличин по данным АМК

"""
Общий план:
1. Программа должна принимать данные наблюдений с АМК
2. Программа должна рассчитывать среднюю температуру воздуха по суткам
и за месяц
3. Программа должна выводить результаты расчета в удобной форме
"""

"""
План реализации:
1. Создать команду получающую данные 
2. Создать регулярное выражение для поиска в тексте строк содержащих данные
наблюдений АМК. Причем только данные в начале каждого из 24 часов в сутках.
3. Создать список содержащий данные в формате ГГГГ-ММ-ДД ЧЧ Твозд
(приблизительно) с помощью методов модуля re
4. Создать функцию редактирующую дату и время наблюдений таким образом,
чтобы они соответствовали метеорологическим суткам и часовому поясу
UTC+3
5. Создать функцию которая будет подсчитывать среднесуточную температуру
6. Создать функцию которая будет подсчитывать среднемесячную температуру
7. Создать функцию которая будет выводить данные для пользователя
"""

import pyperclip  # импорт модуля pyperclip для работы с буфером обмена
import re # импорт модуля для работы с регулярными выражениями

initialData = pyperclip.paste() # вставка исходных данных из буфера обмена

def timeFiltering(data):
    """Функция принимает исходный текст и возвращает список содержащий
    только данные измерений в начале каждого часа"""
    
    amcDataRegex = re.compile(r'''
    (\d\d\d\d-\d\d-\d\d\s\d\d:00)    # ГГГГ-ММ-ДД ЧЧ:00, где 00 - минуты
    (:\d\d)                          # секунды
    (\s)                             # разделитель
    (\d+\.\d+|None)                  # направление ветра
    (\s)                             # разделитель
    (\d+\.\d+|None)                  # скорость ветра
    (\s)                             # разделитель
    (\d+\.\d+|None)                  # порыв ветра
    (\s)                             # разделитель
    (-?\d+\.\d+|None)                # температура точки росы
    (\s)                             # разделитель
    (\d+\.\d+|None)                  # относительная влажность
    (\s)                             # разделитель
    (-?\d+\.\d+|None)                # температура воздуха
    (\s)                             # разделитель
    (\d+\.\d+|None)                  # атмосферное давление
    (\s)                             # разделитель
    (-?\d+\.\d+|None)                # тенденция
    ''',re.X)
    data = amcDataRegex.findall(initialData)

    return data

def temperatureFiltering(data):
    """Функция принимает данные возвращаемые функцией timeFiltering и
    возвращает список содержащий только данные измерений температуры"""
    temperatureList = []
    for i in data:
        string = (i[0] + ';' + i[13])
        temperatureList.append(string)

    return temperatureList

def calendarIntoMeteo(data):
    """Функция принимает список измерений с датами по календарным суткам
    и возвращает список с датами по метеорологическим суткам (следующие
    метеорологические сутки начинаются в 15:00 ВСВ)"""
    lastDayOfMonth = ('01-31', '02-28', '02-29', '03-31', '04-30', '05-31',
                      '06-30', '07-31', '08-31', '09-30', '10-31', '11-30',
                      '12-31') # список содержащий последние даты месяцев
    listOfTerms = list(range(15, 24)) # список содержащий часы, которые
                                      # относятся к следующим суткам
    meteo_list = [] # список содержащий даты по метеорологическим суткам
    for i in data:  # перебираются все элементы исходного списка
        if int(i[11:13]) in listOfTerms:
            # если срез текущего элемента, содержащий значение часа
            # есть в списке относится к срокам переносимым на следующие
            # сутки
            calendarDay = int(i[8:10]) # срез содержащий значение
                                       # календарного дня
            calendarMonth = int(i[5:7])# срез содержащий значение
                                       # календарного месяца
            meteoDay = str(calendarDay + 1) # значение метеорологических
                                            # суток
            meteoMonth = str(calendarMonth + 1) # значение метеорологического
                                                # месяца
            if calendarDay < 9: 
                meteo_list.append(i[:8] + '0' + meteoDay + i[10:])
            elif i[5:10] in lastDayOfMonth: # если срез содержащий значение
                                            # календарного месяца содержится
                                            # в списке последних дат месяцев
                if calendarMonth < 9:
                    meteo_list.append(i[:5] + '0' + meteoMonth + '-01' +
                                    i[10:])
                else:
                    meteo_list.append(i[:5] + meteoMonth + '-01' + i[10:])
            else:
                meteo_list.append(i[:8] + meteoDay + i[10:])
        else:
            meteo_list.append(i)
               
    return meteo_list
